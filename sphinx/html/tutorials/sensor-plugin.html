

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Create a Sensor Plugin &mdash; scrimmage 0.2.0-dev documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Create a Controller Plugin" href="controller-plugin.html" />
    <link rel="prev" title="Draw Shapes in the Viewer" href="draw-shapes.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> scrimmage
          

          
          </a>

          
            
            
              <div class="version">
                0.2.0-dev
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="xml-discovery.html">SCRIMMAGE Plugin / XML File Discovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiple-local-runs.html">Multiple Runs on a Local Computer</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-project.html">Create a SCRIMMAGE Plugins Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="autonomy-plugin.html">Create an Autonomy Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="draw-shapes.html">Draw Shapes in the Viewer</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Create a Sensor Plugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#examine-sensor-plugin">Examine Sensor Plugin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="controller-plugin.html">Create a Controller Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="motion-model-plugin.html">Create a Motion Model Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="entity-interaction-plugin.html">Create an Entity Interaction Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics-plugin.html">Create a Metrics Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters.html">Plugin Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="pub-sub.html">Publishers and Subscribers</a></li>
<li class="toctree-l2"><a class="reference internal" href="gen-entities.html">Generate Entities at Run-Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="ros-plugin.html">Create a ROS Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="airsim-plugin.html">AirSimSensor Plugin Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="openai-plugin.html">Create an OpenAI Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimize.html">Optimizing Parameters in SCRIMMAGE</a></li>
<li class="toctree-l2"><a class="reference internal" href="open-grid.html">Multiple Runs with Open Grid Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="test.html">Create a SCRIMMAGE Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities.html">Useful Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="simcontrol.html">SimControl API</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">scrimmage</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="tutorials.html">Tutorials</a> &raquo;</li>
        
      <li>Create a Sensor Plugin</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/sensor-plugin.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="create-a-sensor-plugin">
<span id="sensor-plugin"></span><h1>Create a Sensor Plugin<a class="headerlink" href="#create-a-sensor-plugin" title="Permalink to this headline">¶</a></h1>
<p>The purpose of a Sensor plugin is to transform ground truth information in the
simulation to altered or “noisy” sensor measurements. Engineers and developers
can model their noise sources and simulate how noisy data will affect their
autonomy, control, and tracking algorithms. To create a Sensor plugin, enter
the following at the terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd /path/to/scrimmage/scripts
$ ./generate-plugin.sh sensor MyNoisyState ~/scrimmage/my-scrimmage-plugins
</pre></div>
</div>
<p>Build the sensor plugin:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd ~/scrimmage/my-scrimmage-plugins/build
$ cmake ..
$ make
</pre></div>
</div>
<div class="section" id="examine-sensor-plugin">
<h2>Examine Sensor Plugin<a class="headerlink" href="#examine-sensor-plugin" title="Permalink to this headline">¶</a></h2>
<p>Similar to an Autonomy plugin, a Sensor plugin has an <code class="docutils literal notranslate"><span class="pre">init</span></code> method that is
called during plugin initialization. In this plugin, we setup the Gaussian
noise sources that will be used to add noise to our own state’s position.</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">MyNoisyState</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Use the same generator as the parent so that the simulation is</span>
    <span class="c1">// completely deterministic with respect to the simulation seed.</span>
    <span class="n">gener_</span> <span class="o">=</span> <span class="n">parent_</span><span class="o">-&gt;</span><span class="n">random</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">gener</span><span class="p">();</span>

    <span class="c1">// Create three independent gaussian noise generators. They will use the</span>
    <span class="c1">// same generator seed.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">tag_name</span> <span class="o">=</span> <span class="s">&quot;pos_noise_&quot;</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">vec</span><span class="p">;</span>
        <span class="kt">bool</span> <span class="n">status</span> <span class="o">=</span> <span class="n">sc</span><span class="o">::</span><span class="n">get_vec</span><span class="p">(</span><span class="n">tag_name</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">pos_noise_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">parent_</span><span class="o">-&gt;</span><span class="n">random</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">make_rng_normal</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">pos_noise_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">parent_</span><span class="o">-&gt;</span><span class="n">random</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">make_rng_normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">pub_</span> <span class="o">=</span> <span class="n">advertise</span><span class="p">(</span><span class="s">&quot;LocalNetwork&quot;</span><span class="p">,</span> <span class="s">&quot;NoisyState&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>A Sensor plugin must implement the <code class="docutils literal notranslate"><span class="pre">step</span></code> method, which is generally
expected to publish some messages.
It should return a boolean indicating if the function was successful.</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="n">MyNoisyState</span><span class="o">::</span><span class="n">step</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Make a copy of the current state</span>
    <span class="n">sc</span><span class="o">::</span><span class="n">State</span> <span class="n">ns</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">parent_</span><span class="o">-&gt;</span><span class="n">state_truth</span><span class="p">());</span>

    <span class="c1">// Create a message to hold the modified state</span>
    <span class="k">auto</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">sc</span><span class="o">::</span><span class="n">Message</span><span class="o">&lt;</span><span class="n">sc</span><span class="o">::</span><span class="n">State</span><span class="o">&gt;&gt;</span><span class="p">();</span>

    <span class="c1">// Add noise to the three scalars in the 3D position vector.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">msg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">pos</span><span class="p">()(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">ns</span><span class="p">.</span><span class="n">pos</span><span class="p">()(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">pos_noise_</span><span class="p">[</span><span class="n">i</span><span class="p">])(</span><span class="o">*</span><span class="n">gener_</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Return the sensor message.</span>
    <span class="n">pub_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>An Autonomy or Controller plugin can use this sensor by adding the sensor to
the entity block in the mission file:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;entity&gt;</span>
...
<span class="nt">&lt;sensor&gt;</span>MyNoiseState<span class="nt">&lt;/sensor&gt;</span>
...
<span class="nt">&lt;/entity&gt;</span>
</pre></div>
</div>
<p>and then “sampling” from the sensor by creating a subscriber:</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">Straight</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">state_cb</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="k">auto</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">noisy_state_set_</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">noisy_state_</span> <span class="o">=</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="controller-plugin.html" class="btn btn-neutral float-right" title="Create a Controller Plugin" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="draw-shapes.html" class="btn btn-neutral float-left" title="Draw Shapes in the Viewer" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Kevin DeMarco

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>