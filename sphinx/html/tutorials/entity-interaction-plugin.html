

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Create an Entity Interaction Plugin &mdash; scrimmage 0.2.0-dev documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="scrimmage 0.2.0-dev documentation" href="../index.html"/>
        <link rel="up" title="Tutorials" href="tutorials.html"/>
        <link rel="next" title="Create a Metrics Plugin" href="metrics-plugin.html"/>
        <link rel="prev" title="Create a Motion Model Plugin" href="motion-model-plugin.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> scrimmage
          

          
          </a>

          
            
            
              <div class="version">
                0.2.0-dev
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="xml-discovery.html">SCRIMMAGE Plugin / XML File Discovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiple-local-runs.html">Multiple Runs on a Local Computer</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-project.html">Create a SCRIMMAGE Plugins Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="autonomy-plugin.html">Create an Autonomy Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="draw-shapes.html">Draw Shapes in the Viewer</a></li>
<li class="toctree-l2"><a class="reference internal" href="sensor-plugin.html">Create a Sensor Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="controller-plugin.html">Create a Controller Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="motion-model-plugin.html">Create a Motion Model Plugin</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Create an Entity Interaction Plugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#examine-entity-interaction-plugin">Examine Entity Interaction Plugin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="metrics-plugin.html">Create a Metrics Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters.html">Plugin Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="pub-sub.html">Publishers and Subscribers</a></li>
<li class="toctree-l2"><a class="reference internal" href="ros-plugin.html">Create a ROS Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="airsim-plugin.html">AirSimSensor Plugin Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="openai-plugin.html">Create an OpenAI Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimize.html">Optimizing Parameters in SCRIMMAGE</a></li>
<li class="toctree-l2"><a class="reference internal" href="open-grid.html">Multiple Runs with Open Grid Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="test.html">Create a SCRIMMAGE Test</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">scrimmage</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="tutorials.html">Tutorials</a> &raquo;</li>
      
    <li>Create an Entity Interaction Plugin</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/tutorials/entity-interaction-plugin.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="create-an-entity-interaction-plugin">
<span id="entity-interaction-plugin"></span><h1>Create an Entity Interaction Plugin<a class="headerlink" href="#create-an-entity-interaction-plugin" title="Permalink to this headline">¶</a></h1>
<p>An entity interaction plugin is used to apply constraints and physical
interactions between entities in the simulation. For example, simple collisions
between entities are implemented through the entity interaction plugin
interface. Also, ground collisions for flying aircraft are implemented using
this interface. Given a high-fidelity motion model, the Bullet entity
interaction SCRIMMAGE plugin implements mesh-based collision detection between
entities. To create an entity interaction plugin, enter the following at the
terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre>$ cd /path/to/scrimmage/scripts
$ ./generate-plugin.sh interaction MyInteraction ~/scrimmage/my-scrimmage-plugins
</pre></div>
</div>
<p>Build the entity interaction plugin:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre>$ cd ~/scrimmage/my-scrimmage-plugins/build
$ cmake ..
$ make
</pre></div>
</div>
<div class="section" id="examine-entity-interaction-plugin">
<h2>Examine Entity Interaction Plugin<a class="headerlink" href="#examine-entity-interaction-plugin" title="Permalink to this headline">¶</a></h2>
<p>The entity interaction plugin implements the <code class="docutils literal notranslate"><span class="pre">init</span></code> method like all
plugins. It also implements the <code class="docutils literal notranslate"><span class="pre">step_entity_interaction</span></code> method, which takes
a list of SCRIMMAGE entities as input. Let’s take a look at the
“GroundCollision” entity interaction that ships with SCRIMMAGE. The
GroundCollision plugin simply determines whether an entity is below a certain
z-position threshold and calls the entity’s <code class="docutils literal notranslate"><span class="pre">collision</span></code> method if it is below
that threshold.</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span class="kt">bool</span> <span class="n">GroundCollision</span><span class="o">::</span><span class="n">step_entity_interaction</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">sc</span><span class="o">::</span><span class="n">EntityPtr</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">ents</span><span class="p">,</span>
                                           <span class="kt">double</span> <span class="n">t</span><span class="p">,</span> <span class="kt">double</span> <span class="n">dt</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Account for entities colliding with</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">sc</span><span class="o">::</span><span class="n">EntityPtr</span> <span class="nl">ent</span> <span class="p">:</span> <span class="n">ents</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ent</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">()(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ground_collision_z_</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ent</span><span class="o">-&gt;</span><span class="n">collision</span><span class="p">();</span>

            <span class="k">auto</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">sc</span><span class="o">::</span><span class="n">Message</span><span class="o">&lt;</span><span class="n">sm</span><span class="o">::</span><span class="n">GroundCollision</span><span class="o">&gt;&gt;</span><span class="p">();</span>
            <span class="n">msg</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">set_entity_id</span><span class="p">(</span><span class="n">ent</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">().</span><span class="n">id</span><span class="p">());</span>
            <span class="n">collision_pub_</span><span class="o">-&gt;</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>The GroundCollision plugin also makes use of SCRIMMAGE’s internal
publish-and-subscribe system. When the plugin determines that a ground
collision exists, it creates a GroundCollision message and publishes it using
the <code class="docutils literal notranslate"><span class="pre">collision_pub_</span></code> variable. The <code class="docutils literal notranslate"><span class="pre">collision_pub_</span></code> member variable was
initialized in the <code class="docutils literal notranslate"><span class="pre">init</span></code> method with the <code class="docutils literal notranslate"><span class="pre">advertise</span></code> method, which
takes a string network name and a string topic name as arguments.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span class="n">collision_pub_</span> <span class="o">=</span> <span class="n">advertise</span><span class="p">(</span><span class="s">&quot;GlobalNetwork&quot;</span><span class="p">,</span> <span class="s">&quot;GroundCollision&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The GroundCollision entity interaction plugin is used in a SCRIMMAGE mission by
adding the following XML tag:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span class="nt">&lt;entity_interaction&gt;</span>GroundCollision<span class="nt">&lt;/entity_interaction&gt;</span>
</pre></div>
</div>
<p>Multiple entity interactions can be used in the same mission file. The order in
which the entity interaction plugins are executed is based on their relative
positions from the top of the XML file. Plugins that are listed first are
executed first. It is common to use both the GroundCollision and
SimpleCollision (collision between entities) in the same simulation. This would
be accomplished with the following XML lines:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span class="nt">&lt;entity_interaction&gt;</span>SimpleCollision<span class="nt">&lt;/entity_interaction&gt;</span>
<span class="nt">&lt;entity_interaction&gt;</span>GroundCollision<span class="nt">&lt;/entity_interaction&gt;</span>
</pre></div>
</div>
<p>Since the entity interaction plugin isn’t applied to a single entity, the
<code class="docutils literal notranslate"><span class="pre">entity_interaction</span></code> tag should exist outside of the <code class="docutils literal notranslate"><span class="pre">entity</span></code> block.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="metrics-plugin.html" class="btn btn-neutral float-right" title="Create a Metrics Plugin" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="motion-model-plugin.html" class="btn btn-neutral" title="Create a Motion Model Plugin" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Kevin DeMarco.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.2.0-dev',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>