

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Create an Autonomy Plugin &mdash; scrimmage 0.2.0-dev documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="scrimmage 0.2.0-dev documentation" href="../index.html"/>
        <link rel="up" title="Tutorials" href="tutorials.html"/>
        <link rel="next" title="Draw Shapes in the Viewer" href="draw-shapes.html"/>
        <link rel="prev" title="Create a SCRIMMAGE Plugins Project" href="create-project.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> scrimmage
          

          
          </a>

          
            
            
              <div class="version">
                0.2.0-dev
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="xml-discovery.html">SCRIMMAGE Plugin / XML File Discovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiple-local-runs.html">Multiple Runs on a Local Computer</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-project.html">Create a SCRIMMAGE Plugins Project</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Create an Autonomy Plugin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#examine-autonomy-plugin">Examine Autonomy Plugin</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#autonomy-plugin-initialization">Autonomy Plugin Initialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-loop-rate">Set Loop Rate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-autonomy">Step Autonomy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-plugin">Running the Plugin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="draw-shapes.html">Draw Shapes in the Viewer</a></li>
<li class="toctree-l2"><a class="reference internal" href="sensor-plugin.html">Create a Sensor Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="controller-plugin.html">Create a Controller Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="motion-model-plugin.html">Create a Motion Model Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="entity-interaction-plugin.html">Create an Entity Interaction Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics-plugin.html">Create a Metrics Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters.html">Plugin Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="pub-sub.html">Publishers and Subscribers</a></li>
<li class="toctree-l2"><a class="reference internal" href="gen-entities.html">Generate Entities at Run-Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="ros-plugin.html">Create a ROS Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="airsim-plugin.html">AirSimSensor Plugin Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="openai-plugin.html">Create an OpenAI Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimize.html">Optimizing Parameters in SCRIMMAGE</a></li>
<li class="toctree-l2"><a class="reference internal" href="open-grid.html">Multiple Runs with Open Grid Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="test.html">Create a SCRIMMAGE Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities.html">Useful Utilities</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">scrimmage</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="tutorials.html">Tutorials</a> &raquo;</li>
      
    <li>Create an Autonomy Plugin</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/tutorials/autonomy-plugin.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="create-an-autonomy-plugin">
<span id="autonomy-plugin"></span><h1>Create an Autonomy Plugin<a class="headerlink" href="#create-an-autonomy-plugin" title="Permalink to this headline">¶</a></h1>
<p>SCRIMMAGE ships with a script that generates an Autonomy plugin template. The
developer needs to provide the name of the Autonomy plugin and the root
directory of your SCRIMMAGE plugins project. We will use the plugins project we
created in the previous tutorial ( <a class="reference internal" href="create-project.html"><span class="doc">Create a SCRIMMAGE Plugins Project</span></a> ) to build our new
Autonomy plugin.</p>
<p>To create an Autonomy plugin, enter the following at the terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre>$ cd /path/to/scrimmage/scripts
$ ./generate-plugin.sh autonomy MyFollowBehavior ~/scrimmage/my-scrimmage-plugins
</pre></div>
</div>
<p>Now, let’s build the plugin that was placed in the my-scrimmage-plugins
project:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre>$ cd ~/scrimmage/my-scrimmage-plugins/build
$ cmake ..
$ make
</pre></div>
</div>
<p>If the plugin built successfuly, you will see the following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span class="p">[</span><span class="mi">100</span><span class="o">%</span><span class="p">]</span> <span class="n">Built</span> <span class="n">target</span> <span class="n">MyFollowBehavior_plugin</span>
</pre></div>
</div>
<div class="section" id="examine-autonomy-plugin">
<h2>Examine Autonomy Plugin<a class="headerlink" href="#examine-autonomy-plugin" title="Permalink to this headline">¶</a></h2>
<div class="section" id="autonomy-plugin-initialization">
<h3>Autonomy Plugin Initialization<a class="headerlink" href="#autonomy-plugin-initialization" title="Permalink to this headline">¶</a></h3>
<p>Let’s take a look at the header file
<code class="docutils literal notranslate"><span class="pre">~/scrimmage/my-scrimmage-plugins/include/my-scrimmage-plugins/plugins/autonomy/MyFollowBehavior/MyFollowBehavior.h</span></code>:</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre> <span class="cp">#ifndef INCLUDE_MY_SCRIMMAGE_PLUGINS_PLUGINS_AUTONOMY_MYFOLLOWBEHAVIOR_MYFOLLOWBEHAVIOR_H_</span>
 <span class="cp">#define INCLUDE_MY_SCRIMMAGE_PLUGINS_PLUGINS_AUTONOMY_MYFOLLOWBEHAVIOR_MYFOLLOWBEHAVIOR_H_</span>
 <span class="cp">#include</span> <span class="cpf">&lt;scrimmage/autonomy/Autonomy.h&gt;</span><span class="cp"></span>

 <span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>
 <span class="cp">#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp"></span>

 <span class="k">namespace</span> <span class="n">scrimmage</span> <span class="p">{</span>
 <span class="k">namespace</span> <span class="n">autonomy</span> <span class="p">{</span>
 <span class="k">class</span> <span class="nc">MyFollowBehavior</span> <span class="o">:</span> <span class="k">public</span> <span class="n">scrimmage</span><span class="o">::</span><span class="n">Autonomy</span> <span class="p">{</span>
  <span class="k">public</span><span class="o">:</span>
     <span class="kt">void</span> <span class="n">init</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">params</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
     <span class="kt">bool</span> <span class="nf">step_autonomy</span><span class="p">(</span><span class="kt">double</span> <span class="n">t</span><span class="p">,</span> <span class="kt">double</span> <span class="n">dt</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>

  <span class="k">protected</span><span class="o">:</span>
     <span class="kt">int</span> <span class="n">desired_alt_idx_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="kt">int</span> <span class="n">desired_speed_idx_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
     <span class="kt">int</span> <span class="n">desired_heading_idx_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 <span class="p">};</span>
 <span class="p">}</span> <span class="c1">// namespace autonomy</span>
 <span class="p">}</span> <span class="c1">// namespace scrimmage</span>
 <span class="cp">#endif </span><span class="c1">// INCLUDE_MY_SCRIMMAGE_PLUGINS_PLUGINS_AUTONOMY_MYFOLLOWBEHAVIOR_MYFOLLOWBEHAVIOR_H_</span>
</pre></div>
</td></tr></table></div>
<p>Note that it inherits from the scrimmage base class <code class="docutils literal notranslate"><span class="pre">Autonomy.h</span></code> located at
<code class="docutils literal notranslate"><span class="pre">scrimmage/include/scrimmage/autonomy/Autonomy.h</span></code> which provides a couple virtual methods,
<code class="docutils literal notranslate"><span class="pre">init</span></code> and <code class="docutils literal notranslate"><span class="pre">step</span></code>,
we will be overriding. The member variables <code class="docutils literal notranslate"><span class="pre">desired_alt_idx_</span></code>, <code class="docutils literal notranslate"><span class="pre">desired_speed_idx_</span></code>,
and <code class="docutils literal notranslate"><span class="pre">desired_heading_idx_</span></code> will be used to interact with the controller. For more details
on interacting with controllers, see <a class="reference internal" href="../overview/variableio.html#variableio"><span class="std std-ref">Variable IO</span></a>.</p>
<p>Now let’s take a look at the Autonomy plugin template code to better understand the
types of information that are available to the Autonomy developer. Use your
favorite text editor to open the file at
<code class="docutils literal notranslate"><span class="pre">~/scrimmage/my-scrimmage-plugins/src/plugins/autonomy/MyFollowBehavior/MyFollowBehavior.cpp</span></code>:</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre> <span class="cp">#include</span> <span class="cpf">&lt;my-scrimmage-plugins/plugins/autonomy/MyFollowBehavior/MyFollowBehavior.h&gt;</span><span class="cp"></span>

 <span class="cp">#include</span> <span class="cpf">&lt;scrimmage/plugin_manager/RegisterPlugin.h&gt;</span><span class="cp"></span>
 <span class="cp">#include</span> <span class="cpf">&lt;scrimmage/entity/Entity.h&gt;</span><span class="cp"></span>
 <span class="cp">#include</span> <span class="cpf">&lt;scrimmage/math/State.h&gt;</span><span class="cp"></span>
 <span class="cp">#include</span> <span class="cpf">&lt;scrimmage/parse/ParseUtils.h&gt;</span><span class="cp"></span>

 <span class="cp">#include</span> <span class="cpf">&lt;limits&gt;</span><span class="cp"></span>

 <span class="k">namespace</span> <span class="n">sc</span> <span class="o">=</span> <span class="n">scrimmage</span><span class="p">;</span>

 <span class="n">REGISTER_PLUGIN</span><span class="p">(</span><span class="n">scrimmage</span><span class="o">::</span><span class="n">Autonomy</span><span class="p">,</span>
                 <span class="n">scrimmage</span><span class="o">::</span><span class="n">autonomy</span><span class="o">::</span><span class="n">MyFollowBehavior</span><span class="p">,</span>
                 <span class="n">MyFollowBehavior_plugin</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>After the relevant header files are included, there is a <code class="docutils literal notranslate"><span class="pre">REGISTER_PLUGIN</span></code>
macro that adds information to your source file so scrimmage can dynamically load it
at runtime. The plugin’s <code class="docutils literal notranslate"><span class="pre">init</span></code> function is pasted below:</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre> <span class="kt">void</span> <span class="n">MyFollowBehavior</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">params</span><span class="p">)</span> <span class="p">{</span>
     <span class="kt">double</span> <span class="n">initial_speed</span> <span class="o">=</span> <span class="n">sc</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;initial_speed&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="mi">21</span><span class="p">);</span>
     <span class="n">desired_alt_idx_</span> <span class="o">=</span> <span class="n">vars_</span><span class="p">.</span><span class="n">declare</span><span class="p">(</span><span class="n">VariableIO</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">desired_altitude</span><span class="p">,</span> <span class="n">VariableIO</span><span class="o">::</span><span class="n">Direction</span><span class="o">::</span><span class="n">Out</span><span class="p">);</span>
     <span class="n">desired_speed_idx_</span> <span class="o">=</span> <span class="n">vars_</span><span class="p">.</span><span class="n">declare</span><span class="p">(</span><span class="n">VariableIO</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">desired_speed</span><span class="p">,</span> <span class="n">VariableIO</span><span class="o">::</span><span class="n">Direction</span><span class="o">::</span><span class="n">Out</span><span class="p">);</span>
     <span class="n">desired_heading_idx_</span> <span class="o">=</span> <span class="n">vars_</span><span class="p">.</span><span class="n">declare</span><span class="p">(</span><span class="n">VariableIO</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">desired_heading</span><span class="p">,</span> <span class="n">VariableIO</span><span class="o">::</span><span class="n">Direction</span><span class="o">::</span><span class="n">Out</span><span class="p">);</span>

     <span class="n">vars_</span><span class="p">.</span><span class="n">output</span><span class="p">(</span><span class="n">desired_speed_idx_</span><span class="p">,</span> <span class="n">initial_speed</span><span class="p">);</span>
     <span class="n">vars_</span><span class="p">.</span><span class="n">output</span><span class="p">(</span><span class="n">desired_alt_idx_</span><span class="p">,</span> <span class="n">state_</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">()(</span><span class="mi">2</span><span class="p">));</span>
     <span class="n">vars_</span><span class="p">.</span><span class="n">output</span><span class="p">(</span><span class="n">desired_heading_idx_</span><span class="p">,</span> <span class="n">state_</span><span class="o">-&gt;</span><span class="n">quat</span><span class="p">().</span><span class="n">yaw</span><span class="p">());</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>This is just setting up the VariableIO to interact with the controller. See
<a class="reference internal" href="../overview/variableio.html#variableio"><span class="std std-ref">Variable IO</span></a> for more details.
The <code class="docutils literal notranslate"><span class="pre">initial_speed</span></code> tag is in the <code class="docutils literal notranslate"><span class="pre">MyFollowBehavior.xml</span></code> file, which
we get from the function <code class="docutils literal notranslate"><span class="pre">get</span></code> found in the <code class="docutils literal notranslate"><span class="pre">ParseUtils.h</span></code> header available
from scrimmage:</p>
<div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="cp">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;http://gtri.gatech.edu&quot;?&gt;</span>
<span class="nt">&lt;params&gt;</span>
   <span class="nt">&lt;library&gt;</span>MyFollowBehavior_plugin<span class="nt">&lt;/library&gt;</span>
   <span class="nt">&lt;initial_speed&gt;</span>24.3<span class="nt">&lt;/initial_speed&gt;</span>
<span class="nt">&lt;/params&gt;</span>
</pre></div>
</td></tr></table></div>
<p>the <code class="docutils literal notranslate"><span class="pre">sc::get&lt;double&gt;()</span></code> function can convert the string value of
<code class="docutils literal notranslate"><span class="pre">initial_speed</span></code> to a double value. The Autonomy plugin developer can add
arbitrarly define tags in the Autonomy plugin’s XML file. The <code class="docutils literal notranslate"><span class="pre">sc::get</span></code>
supports all standard C++ data types, such as <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">double</span></code>,
<code class="docutils literal notranslate"><span class="pre">std::string</span></code>, <code class="docutils literal notranslate"><span class="pre">bool</span></code>, <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span></code>, etc.</p>
</div>
<div class="section" id="set-loop-rate">
<h3>Set Loop Rate<a class="headerlink" href="#set-loop-rate" title="Permalink to this headline">¶</a></h3>
<p>Normally, the loop rate for a plugin should be set with the <code class="docutils literal notranslate"><span class="pre">loop_rate</span></code>
xml tag inside the plugin’s block of the mission file. Using this API the
user doesn’t have to write any code to set the loop rate. However, it’s also
possible to change the loop rate for a plugin dynamically during a simulation.
This is done by calling the plugin’s <code class="docutils literal notranslate"><span class="pre">set_loop_rate()</span></code> method, which
sets the plugin’s loop rate in Hz:</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre> <span class="kt">void</span> <span class="n">MyFollowBehavior</span><span class="o">::</span><span class="n">update_loop_rate</span><span class="p">(</span><span class="kt">double</span> <span class="n">new_loop_rate</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">set_loop_rate</span><span class="p">(</span><span class="n">new_loop_rate</span><span class="p">);</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>The current loop rate can also be accessed with the <code class="docutils literal notranslate"><span class="pre">loop_rate()</span></code> function.</p>
</div>
<div class="section" id="step-autonomy">
<h3>Step Autonomy<a class="headerlink" href="#step-autonomy" title="Permalink to this headline">¶</a></h3>
<p>The real work of the Autonomy plugin is typically implemented in the
<code class="docutils literal notranslate"><span class="pre">step_autonomy</span></code> method.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span class="kt">bool</span> <span class="n">MyFollowBehavior</span><span class="o">::</span><span class="n">step_autonomy</span><span class="p">(</span><span class="kt">double</span> <span class="n">t</span><span class="p">,</span> <span class="kt">double</span> <span class="n">dt</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">step_autonomy</span></code> method takes the current simulation time, <code class="docutils literal notranslate"><span class="pre">t</span></code>, and the
simulation step size <code class="docutils literal notranslate"><span class="pre">dt</span></code>, as inputs. If an error is detected during method
execution, the Autonomy developer can return <code class="docutils literal notranslate"><span class="pre">false</span></code> to inform SCRIMMAGE’s
simulation controller, but typically, <code class="docutils literal notranslate"><span class="pre">true</span></code> should be returned when the
method finishes execution. The example Autonomy plugin that was generated
implements the following simple behavior:</p>
<ol class="arabic simple">
<li>Calculate the distance to each contact in the simulation.</li>
<li>Find the the closest contact that is not on my team.</li>
<li>Head in the direction of the closest contact.</li>
</ol>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="highlight"><pre> <span class="kt">bool</span> <span class="n">MyFollowBehavior</span><span class="o">::</span><span class="n">step_autonomy</span><span class="p">(</span><span class="kt">double</span> <span class="n">t</span><span class="p">,</span> <span class="kt">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{</span>
     <span class="c1">// Find nearest entity on other team. Loop through each contact, calculate</span>
     <span class="c1">// distance to entity, save the ID of the entity that is closest.</span>
     <span class="kt">int</span> <span class="n">follow_id_</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
     <span class="kt">double</span> <span class="n">min_dist</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">infinity</span><span class="p">();</span>
     <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">kv</span> <span class="p">:</span> <span class="o">*</span><span class="n">contacts_</span><span class="p">)</span> <span class="p">{</span>

         <span class="kt">int</span> <span class="n">contact_id</span> <span class="o">=</span> <span class="n">kv</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
         <span class="n">sc</span><span class="o">::</span><span class="n">Contact</span> <span class="o">&amp;</span><span class="n">contact</span> <span class="o">=</span> <span class="n">kv</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>

         <span class="c1">// Skip if this contact is on the same team</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">contact</span><span class="p">.</span><span class="n">id</span><span class="p">().</span><span class="n">team_id</span><span class="p">()</span> <span class="o">==</span> <span class="n">parent_</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">().</span><span class="n">team_id</span><span class="p">())</span> <span class="p">{</span>
             <span class="k">continue</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="c1">// Calculate distance to entity</span>
         <span class="kt">double</span> <span class="n">dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">contact</span><span class="p">.</span><span class="n">state</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">()</span> <span class="o">-</span> <span class="n">state_</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">()).</span><span class="n">norm</span><span class="p">();</span>

         <span class="k">if</span> <span class="p">(</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="n">min_dist</span><span class="p">)</span> <span class="p">{</span>
             <span class="c1">// If this is the minimum distance, save distance and reference to</span>
             <span class="c1">// entity</span>
             <span class="n">min_dist</span> <span class="o">=</span> <span class="n">dist</span><span class="p">;</span>
             <span class="n">follow_id_</span> <span class="o">=</span> <span class="n">contact_id</span><span class="p">;</span>
         <span class="p">}</span>
     <span class="p">}</span>

     <span class="c1">// Head toward entity on other team</span>
     <span class="k">if</span> <span class="p">(</span><span class="n">contacts_</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">(</span><span class="n">follow_id_</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
         <span class="c1">// Get a reference to the entity&#39;s state.</span>
         <span class="n">sc</span><span class="o">::</span><span class="n">StatePtr</span> <span class="n">ent_state</span> <span class="o">=</span> <span class="n">contacts_</span><span class="o">-&gt;</span><span class="n">at</span><span class="p">(</span><span class="n">follow_id_</span><span class="p">).</span><span class="n">state</span><span class="p">();</span>

         <span class="c1">// Calculate the required heading to follow the other entity</span>
         <span class="kt">double</span> <span class="n">heading</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">ent_state</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">()(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">state_</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">()(</span><span class="mi">1</span><span class="p">),</span>
                                <span class="n">ent_state</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">()(</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">state_</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">()(</span><span class="mi">0</span><span class="p">));</span>

         <span class="c1">// Set the heading</span>
         <span class="n">vars_</span><span class="p">.</span><span class="n">output</span><span class="p">(</span><span class="n">desired_heading_idx_</span><span class="p">,</span> <span class="n">heading</span><span class="p">);</span>

         <span class="c1">// Match entity&#39;s altitude</span>
         <span class="n">vars_</span><span class="p">.</span><span class="n">output</span><span class="p">(</span><span class="n">desired_alt_idx_</span><span class="p">,</span> <span class="n">ent_state</span><span class="o">-&gt;</span><span class="n">pos</span><span class="p">()(</span><span class="mi">2</span><span class="p">));</span>
     <span class="p">}</span>

     <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Line 6 is a common way to iterate over all contacts
using range-based for loops available from c++-11. In line 12, we ignore
contacts that are on the same team by checking team IDs. <code class="docutils literal notranslate"><span class="pre">parent_</span></code> is a
reference to the plugin’s parent entity. The parent entity holds references to
the entity’s ID and other plugins. The <code class="docutils literal notranslate"><span class="pre">scrimmage::ID</span></code> class has three member
variables that refer to the entity’s ID, the sub_swarm_id, and the team_id,
respectively. In line 12, we use Eigen’s <code class="docutils literal notranslate"><span class="pre">norm()</span></code> function to calculate the
distance between our entity and the contact. In lines 14 to 18, we determine if
this is the small distance encountered so far and save the distance and ID of
the contact if it is the closest distance.</p>
<p>In the second <code class="docutils literal notranslate"><span class="pre">if</span></code> block,
we set the Autonomy’s controller inputs using <a class="reference internal" href="../overview/variableio.html#variableio"><span class="std std-ref">Variable IO</span></a>.
Line 28 ensures that the ID of the contact that we want to follow exists. Next,
we get a pointer to the contact’s <code class="docutils literal notranslate"><span class="pre">scrimmage::State</span></code> in line 30. Using basic
trigonometry, we calculate the required heading to follow the contact in line
33.  In line 37, we set the desired heading, similarly to how we set the
heading in the initialization method. Finally, we set the desired altitude to
the same altitude of the contact in line 40. If the closest contact search
didn’t succeed in the first part of <code class="docutils literal notranslate"><span class="pre">step_autonomy</span></code>, then the
controller inputs won’t be updated due to the guard.</p>
<p>By just using the state’s of other contacts, Autonomy plugins can implement
formation controllers, spatial search algorithms, biologically-inspired
algorithms, and many other algorithms associated with multi-robot problems. The
contacts in this example are ground truth contacts without any noise. When you
complete the Sensor plugin tutorial (<a class="reference internal" href="sensor-plugin.html"><span class="doc">Create a Sensor Plugin</span></a>), you will learn how
to add noise and filter out contacts based on a sensor model.</p>
</div>
</div>
<div class="section" id="running-the-plugin">
<h2>Running the Plugin<a class="headerlink" href="#running-the-plugin" title="Permalink to this headline">¶</a></h2>
<p>In our project, open <code class="docutils literal notranslate"><span class="pre">missions/example.xml</span></code> and go to the second entity block.
Change <code class="docutils literal notranslate"><span class="pre">count</span></code> to 1 and <code class="docutils literal notranslate"><span class="pre">autonomy</span></code> to <code class="docutils literal notranslate"><span class="pre">MyFollowBehavior</span></code> and save the file:</p>
<div class="highlight-xml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre> <span class="nt">&lt;entity&gt;</span>
   <span class="nt">&lt;team_id&gt;</span>2<span class="nt">&lt;/team_id&gt;</span>
   <span class="nt">&lt;color&gt;</span>255 0 0<span class="nt">&lt;/color&gt;</span>
   <span class="nt">&lt;count&gt;</span>1<span class="nt">&lt;/count&gt;</span>
   <span class="nt">&lt;health&gt;</span>1<span class="nt">&lt;/health&gt;</span>
   <span class="nt">&lt;radius&gt;</span>2<span class="nt">&lt;/radius&gt;</span>

   <span class="c">&lt;!--</span>
<span class="c">   &lt;generate_rate&gt; 1 / 2 &lt;/generate_rate&gt;</span>
<span class="c">   &lt;generate_count&gt;2&lt;/generate_count&gt;</span>
<span class="c">   &lt;generate_start_time&gt;0&lt;/generate_start_time&gt;</span>
<span class="c">   &lt;generate_time_variance&gt;0.10&lt;/generate_time_variance&gt;</span>
<span class="c">   --&gt;</span>

   <span class="nt">&lt;variance_x&gt;</span>20<span class="nt">&lt;/variance_x&gt;</span>
   <span class="nt">&lt;variance_y&gt;</span>20<span class="nt">&lt;/variance_y&gt;</span>
   <span class="nt">&lt;variance_z&gt;</span>20<span class="nt">&lt;/variance_z&gt;</span>

   <span class="nt">&lt;x&gt;</span>50<span class="nt">&lt;/x&gt;</span>
   <span class="nt">&lt;y&gt;</span>0<span class="nt">&lt;/y&gt;</span>
   <span class="nt">&lt;z&gt;</span>200<span class="nt">&lt;/z&gt;</span>

   <span class="nt">&lt;heading&gt;</span>180<span class="nt">&lt;/heading&gt;</span>
   <span class="nt">&lt;altitude&gt;</span>200<span class="nt">&lt;/altitude&gt;</span>
   <span class="nt">&lt;controller&gt;</span>SimpleAircraftControllerPID<span class="nt">&lt;/controller&gt;</span>
   <span class="nt">&lt;motion_model&gt;</span>SimpleAircraft<span class="nt">&lt;/motion_model&gt;</span>
   <span class="nt">&lt;visual_model&gt;</span>zephyr-red<span class="nt">&lt;/visual_model&gt;</span>
   <span class="nt">&lt;autonomy&gt;</span>MyFollowBehavior<span class="nt">&lt;/autonomy&gt;</span>
   <span class="nt">&lt;base&gt;</span>
     <span class="nt">&lt;latitude&gt;</span>35.719961<span class="nt">&lt;/latitude&gt;</span>
     <span class="nt">&lt;longitude&gt;</span>-120.767304<span class="nt">&lt;/longitude&gt;</span>
     <span class="nt">&lt;altitude&gt;</span>300<span class="nt">&lt;/altitude&gt;</span>
     <span class="nt">&lt;radius&gt;</span>25<span class="nt">&lt;/radius&gt;</span>
   <span class="nt">&lt;/base&gt;</span>
 <span class="nt">&lt;/entity&gt;</span>
</pre></div>
</td></tr></table></div>
<p>Now we can run the simulation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre>scrimmage missions/example.xml
</pre></div>
</div>
<p>You can change the viewer by pressing <code class="docutils literal notranslate"><span class="pre">a</span></code> once, scrolling out and moving the picture
so both vehicles are in view. You can additionally press <code class="docutils literal notranslate"><span class="pre">+</span></code> so that the vehicles
are larger. You should see two vehicles approach each other and circle.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="draw-shapes.html" class="btn btn-neutral float-right" title="Draw Shapes in the Viewer" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="create-project.html" class="btn btn-neutral" title="Create a SCRIMMAGE Plugins Project" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Kevin DeMarco.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.2.0-dev',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>