

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Create a ROS Node &mdash; scrimmage 0.2.0-dev documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="AirSimSensor Plugin Setup" href="airsim-plugin.html" />
    <link rel="prev" title="SCRIMMAGE / ROS Integration" href="scrimmage-ros-integration.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> scrimmage
          

          
          </a>

          
            
            
              <div class="version">
                0.2.0-dev
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="xml-discovery.html">SCRIMMAGE Plugin / XML File Discovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiple-local-runs.html">Multiple Runs on a Local Computer</a></li>
<li class="toctree-l2"><a class="reference internal" href="create-project.html">Create a SCRIMMAGE Plugins Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="autonomy-plugin.html">Create an Autonomy Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="draw-shapes.html">Draw Shapes in the Viewer</a></li>
<li class="toctree-l2"><a class="reference internal" href="sensor-plugin.html">Create a Sensor Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="controller-plugin.html">Create a Controller Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="motion-model-plugin.html">Create a Motion Model Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="entity-interaction-plugin.html">Create an Entity Interaction Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics-plugin.html">Create a Metrics Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters.html">Plugin Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="pub-sub.html">Publishers and Subscribers</a></li>
<li class="toctree-l2"><a class="reference internal" href="gen-entities.html">Generate Entities at Run-Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="scrimmage-ros-integration.html">SCRIMMAGE / ROS Integration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Create a ROS Node</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#advanced-usage">Advanced Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="airsim-plugin.html">AirSimSensor Plugin Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="openai-plugin.html">Create an OpenAI Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimize.html">Optimizing Parameters in SCRIMMAGE</a></li>
<li class="toctree-l2"><a class="reference internal" href="open-grid.html">Multiple Runs with Open Grid Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="test.html">Create a SCRIMMAGE Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities.html">Useful Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="simcontrol.html">SimControl API</a></li>
<li class="toctree-l2"><a class="reference internal" href="capture-the-flag.html">Capture the Flag Scenario</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">scrimmage</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="tutorials.html">Tutorials</a> &raquo;</li>
        
      <li>Create a ROS Node</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/ros-plugin.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="create-a-ros-node">
<span id="ros-plugin"></span><h1>Create a ROS Node<a class="headerlink" href="#create-a-ros-node" title="Permalink to this headline">¶</a></h1>
<p>SCRIMMAGE allows quick prototyping for debugging and optimization. After this
process is complete users can easily wrap their working code for implementation
on in a ROS system. In this tutorial we will look at how to do this for the
<code class="docutils literal notranslate"><span class="pre">AuctionAssign</span></code> plugin. You can run this plugin in SCRIMMAGE with the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ scrimmage missions/auction_assign.xml

Agent (1) starting auction
-----------------------------
Time: 0.1
StartAuction: entity ID (1) received message from entity ID: 1
Sending bid of 4.02381
-----------------------------
Time: 0.1
StartAuction: entity ID (2) received message from entity ID: 1
Sending bid of 5.24396
-----------------------------
Time: 0.2
BidAuction: entity ID (1) received message from entity ID (1),  bid: 4.02381
-----------------------------
Time: 0.2
BidAuction: entity ID (1) received message from entity ID (2),  bid: 5.24396
-----------------------------
Time: 0.2
BidAuction: entity ID (2) received message from entity ID (1),  bid: 4.02381
-----------------------------
Time: 0.2
BidAuction: entity ID (2) received message from entity ID (2),  bid: 5.24396
======================================
Auction Complete
Max Bidder: 2
Bid: 5.24396
======================================
</pre></div>
</div>
<p>In this scenario there are two entities. The entity with id 1 starts an
auction on topic <code class="docutils literal notranslate"><span class="pre">StartAuction</span></code> and both entities bid on <code class="docutils literal notranslate"><span class="pre">BidAuction</span></code>. We
would like to place this into a ROS system with minimal effort. First, note
that on embedded systems we may want only a minimal installation of SCRIMMAGE
and its dependencies (e.g., no gui or simulation loop is needed) so one could
have done:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># we don&#39;t need to do this step for the tutorial
# only run this if you are space constrained on an embedded system
$ sudo ./setup/install-binaries.sh -e 0
$ cmake .. -DEXTERNAL=1
</pre></div>
</div>
<p>Let’s build and run the wrapped ROS node available from the <a class="reference external" href="https://github.com/SyllogismRXS/scrimmage_ros">scrimmage_ros</a> ROS
package. Follow the instructions in that repo’s README to setup your catkin
workspace. Once it is installed we can run the <code class="docutils literal notranslate"><span class="pre">auctioneer</span></code> node as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd catkin_ws
$ catkin_make
$ source devel/setup.bash # or source devel/setup.zsh
$ roslaunch scrimmage_ros auction.launch

SUMMARY
========

PARAMETERS
 * /entity_1/entity_id: 1
 * /entity_1/entity_name: agent
 * /entity_1/max_contacts: 100
 * /entity_1/mission_file: ~/scrimmage/scrim...
 * /entity_2/entity_id: 2
 * /entity_2/entity_name: agent
 * /entity_2/max_contacts: 100
 * /entity_2/mission_file: ~/scrimmage/scrim...
 * /rosdistro: kinetic
 * /rosversion: 1.12.12

NODES
  /
    entity_1 (scrimmage_ros/auctioneer)
    entity_2 (scrimmage_ros/auctioneer)

auto-starting new master
process[master]: started with pid [31656]
ROS_MASTER_URI=http://localhost:11311

setting /run_id to d001a062-2233-11e8-9392-484d7ed51daf
process[rosout-1]: started with pid [31669]
started core service [/rosout]
process[entity_1-2]: started with pid [31677]
process[entity_2-3]: started with pid [31687]
Agent (1) starting auction
-----------------------------
Time: 1.52045e+09
StartAuction: entity ID (1) received message from entity ID: 1
Sending bid of -6.84253
-----------------------------
Time: 1.52045e+09
StartAuction: entity ID (2) received message from entity ID: 1
Sending bid of -3.40187
-----------------------------
Time: 1.52045e+09
BidAuction: entity ID (2) received message from entity ID (1),  bid: -6.84253
-----------------------------
Time: 1.52045e+09
BidAuction: entity ID (1) received message from entity ID (1),  bid: -6.84253
-----------------------------
Time: 1.52045e+09
BidAuction: entity ID (1) received message from entity ID (2),  bid: -3.40187
-----------------------------
Time: 1.52045e+09
BidAuction: entity ID (2) received message from entity ID (2),  bid: -3.40187
======================================
Auction Complete
Max Bidder: 2
Bid: -3.40187
======================================
[entity_1-2] process has finished cleanly
log file: /home/syllogismrxs/.ros/log/d001a062-2233-11e8-9392-484d7ed51daf/entity_1-2*.log
[entity_2-3] process has finished cleanly
log file: /home/syllogismrxs/.ros/log/d001a062-2233-11e8-9392-484d7ed51daf/entity_2-3*.log
</pre></div>
</div>
<p>Note that this output is very similar to when we ran it in the SCRIMMAGE
simulation. This is because it is running the exactly same code <a class="footnote-reference brackets" href="#f1" id="id1">1</a>.  The goal of
the design is to have as much code as possible run through simulation so that
bugs are caught relatively cheaply and quickly in front of a computer rather
than in front of an actual robot where debugging can take significantly
longer. Let’s now examine how to wrap the <code class="docutils literal notranslate"><span class="pre">AuctionAssign</span></code> plugin. The
SCRIMMAGE plugin code can be found in the following locations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">include</span><span class="o">/</span><span class="n">scrimmage</span><span class="o">/</span><span class="n">plugins</span><span class="o">/</span><span class="n">autonomy</span><span class="o">/</span><span class="n">AuctionAssign</span><span class="o">/</span><span class="n">AuctionAssign</span><span class="o">.</span><span class="n">h</span>
<span class="n">src</span><span class="o">/</span><span class="n">plugins</span><span class="o">/</span><span class="n">autonomy</span><span class="o">/</span><span class="n">AuctionAssign</span><span class="o">/</span><span class="n">AuctionAssign</span><span class="o">.</span><span class="n">cpp</span>
</pre></div>
</div>
<p>and the ROS node that wraps this plugin can be found online (<a class="reference external" href="https://github.com/SyllogismRXS/scrimmage_ros/blob/master/src/auctioneer.cpp/">auctioneer.cpp</a>).</p>
<p>The most important aspect of the SCRIMMAGE plugin files is that they have
publishers and subscribers on topics <code class="docutils literal notranslate"><span class="pre">StartAuction</span></code> and <code class="docutils literal notranslate"><span class="pre">BidAuction</span></code> that
we want to get into ROS. To do this the user must do is convert between ROS
and SCRIMMAGE messaging formats <a class="footnote-reference brackets" href="#f2" id="id2">2</a> . The rest is handled by the
<code class="docutils literal notranslate"><span class="pre">External</span></code> class provided by SCRIMMAGE. We start by initializing a ROS node as usual:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Initialize</span> <span class="n">the</span> <span class="n">ROS</span> <span class="n">node</span>
<span class="n">ros</span><span class="p">::</span><span class="n">init</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="s2">&quot;auctioneer&quot;</span><span class="p">);</span>
<span class="n">ros</span><span class="p">::</span><span class="n">NodeHandle</span> <span class="n">nh</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Get</span> <span class="n">a</span> <span class="n">private</span> <span class="n">node</span> <span class="n">handle</span> <span class="n">to</span> <span class="n">parse</span> <span class="n">ros</span> <span class="n">params</span>
<span class="n">ros</span><span class="p">::</span><span class="n">NodeHandle</span> <span class="n">private_nh</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Next, we need to get the mission file that contains our entity’s
description. We also need to specify the entity ID for the ROS environment, the
entity name, and the maximum number of contacts. We use ROS’ parameter server
API to load the parameters from <a class="reference external" href="https://github.com/SyllogismRXS/scrimmage_ros/blob/master/launch/auction.launch/">auction.launch</a>.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Get</span> <span class="n">the</span> <span class="n">mission</span> <span class="n">file</span><span class="p">,</span> <span class="n">which</span> <span class="n">holds</span> <span class="n">overrides</span> <span class="k">for</span> <span class="n">plugin</span> <span class="n">parameters</span>
<span class="n">std</span><span class="p">::</span><span class="n">string</span> <span class="n">mission_file</span><span class="p">;</span>
<span class="n">private_nh</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;mission_file&quot;</span><span class="p">,</span> <span class="n">mission_file</span><span class="p">,</span> <span class="n">std</span><span class="p">::</span><span class="n">string</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">));</span>

<span class="o">//</span> <span class="n">Get</span> <span class="n">the</span> <span class="n">entity</span> <span class="n">ID</span>
<span class="nb">int</span> <span class="n">entity_id</span><span class="p">;</span>
<span class="n">private_nh</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;entity_id&quot;</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Get</span> <span class="n">the</span> <span class="n">entity</span> <span class="n">name</span><span class="o">.</span> <span class="n">This</span> <span class="n">name</span> <span class="n">should</span> <span class="n">match</span> <span class="n">the</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">the</span>
<span class="o">//</span> <span class="n">mission</span> <span class="n">file</span> <span class="k">for</span> <span class="n">the</span> <span class="n">entity</span> <span class="n">block</span> <span class="n">we</span> <span class="n">want</span> <span class="n">to</span> <span class="n">use</span><span class="o">.</span>
<span class="n">std</span><span class="p">::</span><span class="n">string</span> <span class="n">entity_name</span><span class="p">;</span>
<span class="n">private_nh</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;entity_name&quot;</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">,</span> <span class="n">std</span><span class="p">::</span><span class="n">string</span><span class="p">(</span><span class="s2">&quot;UNDEFINED&quot;</span><span class="p">));</span>

<span class="o">//</span> <span class="n">Specify</span> <span class="n">the</span> <span class="n">maximum</span> <span class="n">number</span> <span class="n">of</span> <span class="n">contacts</span> <span class="n">that</span> <span class="n">we</span> <span class="n">will</span> <span class="n">encounter</span><span class="o">.</span>
<span class="nb">int</span> <span class="n">max_contacts</span><span class="p">;</span>
<span class="n">private_nh</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s2">&quot;max_contacts&quot;</span><span class="p">,</span> <span class="n">max_contacts</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</pre></div>
</div>
<p>The entity name is used to specify which entity block in the SCRIMMAGE mission
file should be used to initialize the entity, since the mission file could
define multiple entity blocks. In order to use an entity block from the mission
file, the entity block needs to define the <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code> tag. In our
<a class="reference external" href="https://github.com/gtri/scrimmage/blob/master/missions/auction_assign.xml">auction_assign.xml</a>
mission file, we set the name to “agent” (e.g. <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;agent&lt;/name&gt;</span></code>).</p>
<p>We can now create the entity:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="p">::</span><span class="n">External</span> <span class="n">external</span><span class="p">;</span>
<span class="n">external</span><span class="o">.</span><span class="n">create_entity</span><span class="p">(</span><span class="n">mission_file</span><span class="p">,</span> <span class="n">max_contacts</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">);</span>
</pre></div>
</div>
<p>Now that our entity has been initalized, we have to setup the publishers and
subscribers that shuttle data between the ROS and SCRIMMAGE environments. The
SCRIMMAGE auction plugins publish and subscribe to the “StartAuction” topic and
they publish and subscribe on the “BidAuction” topic. Thus, we need to setup
ROS publishers and subscribers for both of these topics. Let’s setup a ROS
publisher for the “StartAuction” topic.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">scrimmage_ros</span><span class="p">::</span><span class="n">RosBidAuction</span><span class="p">;</span>
<span class="n">using</span> <span class="n">scrimmage_ros</span><span class="p">::</span><span class="n">RosStartAuction</span><span class="p">;</span>

<span class="n">ros</span><span class="p">::</span><span class="n">Publisher</span> <span class="n">pub_start_auction</span> <span class="o">=</span>
    <span class="n">nh</span><span class="o">.</span><span class="n">advertise</span><span class="o">&lt;</span><span class="n">RosStartAuction</span><span class="o">&gt;</span><span class="p">(</span><span class="s2">&quot;StartAuction&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
</pre></div>
</div>
<p>Now, we need to link the SCRIMMAGE publisher on the “StartAuction” topic to
this ROS publisher:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">external</span><span class="o">.</span><span class="n">pub_cb</span><span class="o">&lt;</span><span class="n">auction</span><span class="p">::</span><span class="n">StartAuction</span><span class="o">&gt;</span><span class="p">(</span><span class="s2">&quot;SphereNetwork&quot;</span><span class="p">,</span> <span class="s2">&quot;StartAuction&quot;</span><span class="p">,</span>
                                       <span class="n">sc2ros_start_auction</span><span class="p">,</span> <span class="n">pub_start_auction</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">auction::StartAuction</span></code> type is a SCRIMMAGE message type. We want to use
the SCRIMMAGE publisher that is on the “SphereNetwork” and using topic
“StartAuction”. Note, that we passed the ROS publisher (<code class="docutils literal notranslate"><span class="pre">pub_start_auction</span></code>)
to the <code class="docutils literal notranslate"><span class="pre">pub_cb</span></code> method. The <code class="docutils literal notranslate"><span class="pre">sc2ros_start_auction</span></code> variable is a function
that converts a SCRIMMAGE message type to a ROS message type. We have to define
this function before the <code class="docutils literal notranslate"><span class="pre">pub_cb</span></code> line::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RosStartAuction</span> <span class="n">sc2ros_start_auction</span><span class="p">(</span><span class="n">const</span> <span class="n">auction</span><span class="p">::</span><span class="n">StartAuction</span> <span class="o">&amp;</span><span class="n">sc_msg</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">RosStartAuction</span> <span class="n">ros_msg</span><span class="p">;</span>
    <span class="n">ros_msg</span><span class="o">.</span><span class="n">sender_id</span> <span class="o">=</span> <span class="n">sc_msg</span><span class="o">.</span><span class="n">sender_id</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">ros_msg</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A similar publisher is setup for the “BidAuction” topic. Let’s setup a
subscriber for the “StartAuction” topic. First, we need to define the function
that will convert from a ROS message type to a SCRIMMAGE message type::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">auction</span><span class="p">::</span><span class="n">StartAuction</span> <span class="n">ros2sc_start_auction</span><span class="p">(</span><span class="n">const</span> <span class="n">RosStartAuction</span> <span class="o">&amp;</span><span class="n">ros_msg</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">auction</span><span class="p">::</span><span class="n">StartAuction</span> <span class="n">sc_msg</span><span class="p">;</span>
    <span class="n">sc_msg</span><span class="o">.</span><span class="n">set_sender_id</span><span class="p">(</span><span class="n">ros_msg</span><span class="o">.</span><span class="n">sender_id</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">sc_msg</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now, let’s setup a ROS subscriber::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ros</span><span class="p">::</span><span class="n">Subscriber</span> <span class="n">sub_start_auction</span> <span class="o">=</span> <span class="n">nh</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s2">&quot;StartAuction&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span>
      <span class="n">external</span><span class="o">.</span><span class="n">sub_cb</span><span class="o">&lt;</span><span class="n">RosStartAuction</span><span class="o">&gt;</span><span class="p">(</span><span class="s2">&quot;SphereNetwork&quot;</span><span class="p">,</span> <span class="s2">&quot;StartAuction&quot;</span><span class="p">,</span>
      <span class="n">ros2sc_start_auction</span><span class="p">));</span>
</pre></div>
</div>
<p>Here the <code class="docutils literal notranslate"><span class="pre">External</span></code> class is providing a ROS callback so we don’t have to
write one ourselves. In <code class="docutils literal notranslate"><span class="pre">External::sub_cb</span></code> the template is the ROS message
type and the parameters are the SCRIMMAGE network name (“SphereNetwork”), the
topic name (“StartAuction”), and the ROS to SCRIMMAGE conversion function.</p>
<p>We can then enter the main loop as with a normal ROS node:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="p">(</span><span class="n">ros</span><span class="p">::</span><span class="n">ok</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">external</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">ros</span><span class="p">::</span><span class="n">Time</span><span class="p">::</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">toSec</span><span class="p">());</span>
    <span class="n">loop_rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">();</span>
    <span class="n">ros</span><span class="p">::</span><span class="n">spinOnce</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The only new line above is the <code class="docutils literal notranslate"><span class="pre">External::step</span></code> call. This method performs
logging, updates any autonomies or controllers, and publishes messages on the
ROS system. Callbacks are handled as messages are received.</p>
<div class="section" id="advanced-usage">
<h2>Advanced Usage<a class="headerlink" href="#advanced-usage" title="Permalink to this headline">¶</a></h2>
<p>There are a few additional cases that the <code class="docutils literal notranslate"><span class="pre">External</span></code> class can handle that
are not addressed in this tutorial.</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">update_contacts</span></code> - Often entities need to know that state of their
neighbors. If this is the case, <code class="docutils literal notranslate"><span class="pre">update_contacts</span></code> is a callback
called in the <code class="docutils literal notranslate"><span class="pre">External::step</span></code> that will set the
<code class="docutils literal notranslate"><span class="pre">External::entity()-&gt;contacts()</span></code> variable.</p></li>
<li><p>Services - SCRIMMAGE allows multiple autonomies to exist on a single
entity similar to decoupled ROS nodes. In particular, these autonomies
can provide services to each other and <code class="docutils literal notranslate"><span class="pre">External</span></code> provides wrapping
similar to <code class="docutils literal notranslate"><span class="pre">sub_cb</span></code> and <code class="docutils literal notranslate"><span class="pre">pub_cb</span></code> for wrapping these service calls.</p></li>
</ol>
</div></blockquote>
<dl class="footnote brackets">
<dt class="label" id="f1"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>the random seed is different in the ROS simulation which causes the bids to be different.</p>
</dd>
<dt class="label" id="f2"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>A user can use ROS messages within SCRIMMAGE. In this case the conversions are trivial.</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="airsim-plugin.html" class="btn btn-neutral float-right" title="AirSimSensor Plugin Setup" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="scrimmage-ros-integration.html" class="btn btn-neutral float-left" title="SCRIMMAGE / ROS Integration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Kevin DeMarco

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>